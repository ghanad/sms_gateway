{% extends 'base.html' %}

{% block content %}
<div class="flex flex-col gap-8">
    <nav aria-label="Breadcrumb" class="flex items-center gap-2 text-sm text-slate-500">
        <a href="{% url 'messaging:my_messages_list' %}" class="font-medium text-slate-600 transition hover:text-slate-900">Messages</a>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
        <span class="font-semibold text-slate-900">Message Details</span>
    </nav>

    <header class="flex flex-col gap-3">
        <div>
            <h1 class="text-3xl font-semibold text-slate-900">Message Details</h1>
            <p class="text-slate-500">Full history for this SMS message.</p>
        </div>
        <div class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-4 py-2 text-sm font-medium text-slate-700">
            <span class="inline-flex size-2 rounded-full bg-emerald-500"></span>
            {{ object.get_status_display }}
        </div>
    </header>

    <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <div class="flex flex-col gap-8">
            <div class="flex flex-col gap-1">
                <h2 class="text-xl font-semibold text-slate-900">Message Details</h2>
                <p class="text-sm text-slate-500">Key information about this delivery.</p>
            </div>
            <dl class="grid gap-6 md:grid-cols-2">
                <div class="flex flex-col gap-1">
                    <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Message ID</dt>
                    <dd class="text-base font-medium text-slate-900 break-all">{{ object.tracking_id }}</dd>
                </div>
                <div class="flex flex-col gap-1">
                    <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Recipient</dt>
                    <dd class="text-base font-medium text-slate-900">{{ object.recipient }}</dd>
                </div>
                <div class="flex flex-col gap-1">
                    <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Sender</dt>
                    <dd class="text-base font-medium text-slate-900">{{ object.provider.default_sender }}</dd>
                </div>
                <div class="flex flex-col gap-1">
                    <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Status</dt>
                    <dd class="text-base font-medium text-slate-900">{{ object.get_status_display }}</dd>
                </div>
                <div class="flex flex-col gap-1">
                    <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Message Content</dt>
                    <dd class="text-base font-medium text-slate-900 whitespace-pre-line">{{ object.text }}</dd>
                </div>
                <div class="flex flex-col gap-1">
                    <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Cost</dt>
                    <dd class="text-base font-medium text-slate-900">N/A</dd>
                </div>
            </dl>
        </div>
    </section>

    <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <div class="flex flex-col gap-8">
            <div class="flex flex-col gap-1">
                <h2 class="text-xl font-semibold text-slate-900">Message Timeline</h2>
                <p class="text-sm text-slate-500">Track the lifecycle of this message.</p>
            </div>
            <ol class="relative flex flex-col gap-6">
                {% with request_timestamp=object.initial_envelope.created_at queued_timestamp=object.created_at sent_timestamp=object.sent_at delivered_timestamp=object.delivered_at %}
                    {% if request_timestamp %}
                    <li class="relative flex gap-4">
                        <div class="flex h-full flex-col items-center">
                            <span class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-100 text-slate-700">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                                    <path d="M22 12v5a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-5" />
                                    <path d="m16 6-4 4-4-4" />
                                    <path d="M12 10V2" />
                                </svg>
                            </span>
                            {% if queued_timestamp or sent_timestamp or delivered_timestamp %}
                            <span aria-hidden="true" class="mt-2 h-full w-px bg-slate-200"></span>
                            {% endif %}
                        </div>
                        <div class="flex flex-col gap-1">
                            <p class="text-sm font-semibold text-slate-900">Request Received</p>
                            {% with formatted=request_timestamp|date:"Y-m-d H:i A" %}
                                <p class="text-xs uppercase tracking-wide text-slate-500">{% firstof formatted request_timestamp %}</p>
                            {% endwith %}
                            <p class="text-sm text-slate-500">Gateway accepted the inbound request.</p>
                        </div>
                    </li>
                    {% endif %}

                    {% if queued_timestamp %}
                    <li class="relative flex gap-4">
                        <div class="flex h-full flex-col items-center">
                            <span class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-100 text-slate-700">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                                    <rect x="3" y="4" width="18" height="6" rx="2" />
                                    <rect x="3" y="14" width="18" height="6" rx="2" />
                                    <path d="M3 14h18" />
                                </svg>
                            </span>
                            {% if sent_timestamp or delivered_timestamp %}
                            <span aria-hidden="true" class="mt-2 h-full w-px bg-slate-200"></span>
                            {% endif %}
                        </div>
                        <div class="flex flex-col gap-1">
                            <p class="text-sm font-semibold text-slate-900">Queued for Processing</p>
                            {% with formatted=queued_timestamp|date:"Y-m-d H:i A" %}
                                <p class="text-xs uppercase tracking-wide text-slate-500">{% firstof formatted queued_timestamp %}</p>
                            {% endwith %}
                            <p class="text-sm text-slate-500">Message persisted and awaiting provider dispatch.</p>
                        </div>
                    </li>
                    {% endif %}

                    {% if sent_timestamp %}
                    <li class="relative flex gap-4">
                        <div class="flex h-full flex-col items-center">
                            <span class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-100 text-slate-700">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                                    <path d="M22 2L11 13" />
                                    <path d="M22 2L15 22L11 13L2 9L22 2Z" />
                                </svg>
                            </span>
                            {% if delivered_timestamp %}
                            <span aria-hidden="true" class="mt-2 h-full w-px bg-slate-200"></span>
                            {% endif %}
                        </div>
                        <div class="flex flex-col gap-1">
                            <p class="text-sm font-semibold text-slate-900">Message Sent</p>
                            <p class="text-xs uppercase tracking-wide text-slate-500">{{ sent_timestamp|date:"Y-m-d H:i A" }}</p>
                            <p class="text-sm text-slate-500">The message was successfully handed off to the provider.</p>
                        </div>
                    </li>
                    {% endif %}

                    {% if delivered_timestamp %}
                    <li class="relative flex gap-4">
                        <div class="flex h-full flex-col items-center">
                            <span class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-100 text-slate-700">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
                                    <path d="M2 11l10 3l10-3" />
                                    <path d="M6 3h12" />
                                </svg>
                            </span>
                        </div>
                        <div class="flex flex-col gap-1">
                            <p class="text-sm font-semibold text-slate-900">Delivered to Device</p>
                            <p class="text-xs uppercase tracking-wide text-slate-500">{{ delivered_timestamp|date:"Y-m-d H:i A" }}</p>
                            <p class="text-sm text-slate-500">Confirmation that the device acknowledged delivery.</p>
                        </div>
                    </li>
                    {% endif %}

                    {% if not request_timestamp and not queued_timestamp and not sent_timestamp and not delivered_timestamp %}
                    <li class="flex flex-col gap-1 text-sm text-slate-500">
                        <p>No delivery events recorded for this message yet.</p>
                    </li>
                    {% endif %}
                {% endwith %}
            </ol>
        </div>
    </section>
</div>
{% endblock %}
